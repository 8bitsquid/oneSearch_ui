function inArray(a,b){return b.indexOf(a)>-1}function isEmpty(a){if(null==a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0}function toArray(a){return Array.isArray(a)?a:Object.keys(a).map(function(b){return a[b]})}angular.module("oneSearch.templates",["bento/bento.tpl.html","common/directives/suggest/suggest.tpl.html","common/engines/acumen/acumen.tpl.html","common/engines/catalog/catalog.tpl.html","common/engines/databases/databases.tpl.html","common/engines/ejournals/ejournals.tpl.html","common/engines/google-cs/google-cs.tpl.html","common/engines/recommend/recommend.tpl.html","common/engines/scout/scout.tpl.html"]),angular.module("bento/bento.tpl.html",[]).run(["$templateCache",function(a){a.put("bento/bento.tpl.html",'<div class="bento-box-container">\n    <div class="bento-box-menu-container hidden-sm hidden-xs">\n        <nav class="bento-box-menu navbar navbar-default" ui-scrollfix="+0">\n            <ul class="nav nav-justified">\n                <li ng-repeat="item in boxMenu">\n                    <a href="" du-smooth-scroll="{{item.box}}" ng-click="selectBox(item.box)">{{item.title}}</a>\n                </li>\n            </ul>\n        </nav>\n    </div>\n    <div class="row">\n        <div class="col-md-4">\n            <div class="bento-box" bento-box="articles">\n                <h2>Articles</h2>\n\n            </div>\n        </div>\n        <div class="col-md-4">\n            <div class="bento-box" bento-box="books">\n                <h2>Books</h2>\n            </div>\n        </div>\n\n        <div class="col-sm-12 col-md-4">\n            <div class="bento-box" bento-box="journals">\n                <h2>Journals</h2>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-6">\n            <div class="bento-box" bento-box="media">\n                <h2>Multimedia</h2>\n            </div>\n        </div>\n        <div class="col-md-6">\n            <div class="bento-box" bento-box="acumen">\n                <h2 id="acumen">Acumen</h2>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-4">\n            <div class="bento-box" bento-box="databases">\n                <h2>Databases </h2>\n            </div>\n        </div>\n        <div class="col-md-4">\n            <div class="bento-box" bento-box="other">\n                <h2>Other Media</h2>\n            </div>\n        </div>\n        <div class="col-sm-12 col-md-4">\n            <div class="bento-box" bento-box="libguides">\n                <h2>Research Guides</h2>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-6">\n            <div class="bento-box" bento-box="googleCS">\n                <h2 id="site-search">Libraries\' Website</h2>\n\n            </div>\n        </div>\n\n        <div class="col-md-6">\n            <div class="bento-box" bento-box="faq">\n                <h2>FAQ</h2>\n            </div>\n        </div>\n    </div>\n    <div class="row">\n        <div class="col-md-12">\n            <div class="bento-box well" bento-box="recommend" hide-if-empty="true" omit-from-menu="true">\n                <h2>Recommended Links</h2>\n\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("common/directives/suggest/suggest.tpl.html",[]).run(["$templateCache",function(a){a.put("common/directives/suggest/suggest.tpl.html",'<div class="input-group input-group-lg">\n    <input type="text" name="search" class="form-control onesearch-text" placeholder="{{prompt}}"\n           ng-model="model" ng-change="onChange()" autocomplete="off" ng-blur="onBlur()" ng-focus="onFocus()" />\n    <div class="input-group-btn">\n        <button type="submit" class="btn btn-onesearch btn-primary"><span class="fa fa-search"></span></button>\n    </div>\n</div>\n<div class="suggest" ng-show="showSuggestions && selected && (items.suggest.length > 0 || items.recommend.length > 0 || items.subjects[0].subjects.length > 0 || items.faq.length > 0)">\n    <div ng-show="items.suggest.length > 0">\n        <ul class="nav nav-pills nav-stacked">\n            <li role="presentation"\n                ng-repeat="item in filteredItems = (items.suggest | filter:compare(originalValue)) | limitTo:numShow track by $index"\n                ng-mousedown="handleSelection(item.search)" ng-class="item.class"\n                ng-mouseenter="setCurrent($index, false)">\n                <a href="#/bento/{{item.search}}">{{item.search}}</a>\n            </li>\n        </ul>\n    </div>\n    <div class="suggest-row" ng-show="items.recommend.length > 0 || items.subjects[0].subjects.length > 0 || items.faq.length > 0">\n        <div class="row">\n            <div class="col-sm-4 suggest-col" ng-show="items.recommend.length > 0">\n                <div class="">\n                    <h4>Recommended Links</h4>\n                    <div ng-repeat="recommendation in items.recommend | limitTo:10">\n                        <a href="{{recommendation.link}}" ng-mousedown="go(recommendation.link)">\n                            {{recommendation.description}}\n                        </a>\n                    </div>\n                </div>\n            </div>\n            <div class="col-sm-4 suggest-col" ng-show="items.subjects[0].subjects.length > 0">\n                <div class="">\n                    <h4>LibGuides Subjects <a href="http://guides.lib.ua.edu/" class="small" ng-mousedown="go(\'http://guides.lib.ua.edu/\')">more</a></h4>\n                    <div ng-repeat="person in items.subjects | limitTo:10">\n                        <div ng-repeat="subject in person.subjects | limitTo:2">\n                            <a ng-if="subject.link.length > 7" href="{{subject.link}}" ng-mousedown="go(subject.link)">\n                                {{subject.subject}}\n                            </a>\n                            <a ng-if="subject.link.length <= 7" href="#"\n                               ng-mousedown="go(\'mailto:\' + person.email + \'?subject=Question\')">\n                                Ask {{person.name}}, {{person.title}} at {{person.department}}\n                            </a>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="col-sm-4 suggest-col" ng-show="items.faq.length > 0">\n                <div class="">\n                    <h4>FAQ <a href="http://ask.lib.ua.edu/" class="small" ng-mousedown="go(\'http://ask.lib.ua.edu/\')">more</a></h4>\n                    <div ng-repeat="faq in items.faq | limitTo:5">\n                        <a ng-href="{{faq.link}}" ng-mousedown="go(faq.link)" ng-bind-html="faq.title">\n                        </a>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("common/engines/acumen/acumen.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/acumen/acumen.tpl.html",'<div class="media">\n    <a class="pull-left" ng-href="http://acumen.lib.ua.edu/{{item.link}}" title="{{item.title}}">\n        <img ng-src="{{item.thumb_path}}">\n    </a>\n    <div class="media-body">\n        <h4 class="media-heading">\n            <a ng-href="http://acumen.lib.ua.edu/{{item.link}}" title="item.title">{{item.title | truncate: 40: \'...\': true}}</a>\n        </h4>\n        <div class="details-context">\n            <span ng-if="item.date" ng-bind-html="item.date"></span>\n            <span ng-if="item.type" ng-bind-html="item.type | ucfirst"></span>\n        </div>\n        <p>{{item.description | truncate: 125: \'...\': true}}</p>\n    </div>\n</div>')}]),angular.module("common/engines/catalog/catalog.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/catalog/catalog.tpl.html",'<div class="media">\n    <div class="media-body">\n        <h4 class="media-heading">\n            <a ng-href="{{item.href}}"\n               title="{{item.title}}"\n               ng-bind-html="item.title | truncate: 50: \'...\': true"></a>\n        </h4>\n        <div class="details-context">\n            <span ng-if="item.year && item.year | number" ng-bind-html="item.year"></span>\n            <span ng-if="item.mediaType" ng-bind-html="item.mediaType"></span>\n            <span ng-if="item.issn">ISSN: {{item.issn}}</span>\n        </div>\n        <div class="details-container" ng-if="item.author">\n            <span class="text-muted">Author(s)</span>\n            <span class="detail">\n                <span ng-bind-html="item.author | lowercase | ucfirst"></span>\n            </span>\n        </div>\n    </div>\n</div>')}]),angular.module("common/engines/databases/databases.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/databases/databases.tpl.html",'<div class="media">\n    <div class="media-body">\n        <h4 class="media-heading">\n            <a ng-href="{{item.url}}" title="{{item.title}}">{{item.title | truncate: 40: \'...\': true}}</a>\n        </h4>\n        <div class="details-context">\n            <span ng-if="item.coverage" ng-bind-html="item.coverage"></span>\n        </div>\n        <p>\n            {{item.description | truncate: 125: \'...\'}}\n        </p>\n    </div>\n</div>')}]),angular.module("common/engines/ejournals/ejournals.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/ejournals/ejournals.tpl.html",'<div class="media">\n    <div class="media-body">\n        <h4 class="media-heading">\n            <a ng-href="{{item.links[0].href}}" title="{{item.title}}">{{item.title | ltrim | truncate: 50: \'...\': true}}</a>\n        </h4>\n\n        <div class="details-context">\n            <span ng-if="item.date" ng-bind-html="item.date"></span>\n            <span ng-if="item.links[0]">\n                <span title="{{item.links[0].name}}">{{item.links[0].name | ltrim | truncate: 35: \'...\'}}</span>\n            </span>\n        </div>\n\n        <div class="details-container" ng-if="item.authors">\n            <span class="text-muted">Authors </span>\n            <span class="details" ng-bind-html="item.authors"></span>\n        </div>\n\n        <div class="details-container" ng-if="item.links[1]">\n            <span class="text-muted">Other Sources </span>\n            <span class="details" ng-repeat="link in item.links | after:1 | limitTo : (sourceLimit ? 10 : 2)">\n                <a ng-href="{{link.href}}"\n                   title="{{link.name}}"\n                   class="source-link"\n                   ng-bind-html="link.name | ltrim | truncate: 35: \'...\': true"></a>\n            </span>\n            <div ng-show="item.links[3]">\n                <button type="button" class="btn btn-default btn-xs" ng-click="sourceLimit = !sourceLimit">{{sourceLimit? \'less\' : \'more\'}} sources</button>\n            </div>\n        </div>\n    </div>\n</div>')}]),angular.module("common/engines/google-cs/google-cs.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/google-cs/google-cs.tpl.html",'<div class="media">\n    <div class="media-body">\n        <h4 class="media-heading"><a ng-href="{{item.link}}" title="{{item.title}}">{{item.title | truncate: 40: \'...\': true}}</a></h4>\n        <p ng-bind-html="item.htmlSnippet"></p>\n    </div>\n</div>\n<!--div class="media">\n    <div class="media-body">\n        <h4 class="media-heading"><a href="http://guides.lib.ua.edu">Library Guides</a></h4>\n        <div class="media" ng-repeat="guide in items | limitTo:2 | filter:{link:\'guides.lib.ua.edu\'}">\n            <a class="media-left" ng-href="{{guide.link}}" title="{{guide.title}}">\n                <img ng-src="guide.pagemap.cse_thumbnail[0].src"\n                     width="{{guide.pagemap.cse_thumbnail[0].width}}"\n                     height="{{guide.pagemap.cse_thumbnail[0].height}}">\n            </a>\n            <div class="media-body">\n                <h4 class="media-heading">\n                    <a ng-href="{{guide.link}}">{{guide.title}}</a>\n                </h4>\n                <p>{{guide.snippet}}</p>\n            </div>\n        </div>\n    </div>\n</div-->')}]),angular.module("common/engines/recommend/recommend.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/recommend/recommend.tpl.html",'<a ng-href="{{item.link}}" title="{{item.descr}}">{{item.descr}}</a>\n')}]),angular.module("common/engines/scout/scout.tpl.html",[]).run(["$templateCache",function(a){a.put("common/engines/scout/scout.tpl.html",'<div class="media">\n    <div class="media-body">\n        <h4 class="media-heading">\n            <a ng-href="{{item.PLink}}"\n               title="{{item.Items[0].Data}}"\n               ng-bind-html="item.RecordInfo.BibRecord.BibEntity.Titles[0].TitleFull | lowercase | ucfirst"></a>\n        </h4>\n        <div class="details-context">\n            <span ng-if="item.RecordInfo.BibRecord.BibRelationships.IsPartOfRelationships[0].BibEntity.Dates[0]">{{item.RecordInfo.BibRecord.BibRelationships.IsPartOfRelationships[0].BibEntity.Dates[0].Y}} </span>\n            <span ng-if="item.mediaType">{{item.mediaType}} </span>\n            <span ng-if="item.FullText.Text.Availability">Full Text Online</span>\n        </div>\n        <div collapse="isCollapsed" ng-show="(item.RecordInfo.BibRecord.BibRelationships.HasContributorRelationships || item.source || item.RecordInfo.BibRecord.BibEntity.Subjects)">\n            <div class="details-container" ng-if="item.RecordInfo.BibRecord.BibRelationships.HasContributorRelationships">\n                <span class="text-muted">Authors </span>\n            <span class="details"\n                  ng-repeat="author in item.RecordInfo.BibRecord.BibRelationships.HasContributorRelationships | unique: \'PersonEntity.Name.NameFull\'"\n                  ng-bind-html="author.PersonEntity.Name.NameFull | lowercase | ucfirst"></span>\n            </div>\n\n            <div class="details-container" ng-if="item.source">\n                <span class="text-muted">Sources </span>\n                <span class="details" ng-bind-html="item.source"></span>\n            </div>\n\n            <div class="details-container" ng-if="item.RecordInfo.BibRecord.BibEntity.Subjects">\n                <span class="text-muted">Subejcts </span>\n            <span class="details"\n                  ng-repeat="subject in item.RecordInfo.BibRecord.BibEntity.Subjects"\n                  ng-bind-html="subject.SubjectFull"></span>\n            </div>\n        </div>\n        <div ng-show="item.RecordInfo.BibRecord.BibRelationships.HasContributorRelationships || item.source || item.RecordInfo.BibRecord.BibEntity.Subjects">\n            <button type="button" class="btn btn-default btn-xs" ng-click="isCollapsed = !isCollapsed">{{!isCollapsed ? \'less\' : \'more\'}} detail</button>\n        </div>\n    </div>\n</div>')}]),angular.module("oneSearch",["ngRoute","ngResource","ngAnimate","ngSanitize","ui.bootstrap","angular.filter","duScroll","ualib.ui","oneSearch.common","oneSearch.templates","oneSearch.bento"]).constant("UALIB_DOMAIN","//wwwdev2.lib.ua.edu/").value("SearchParams",{limit:100}).value("duScrollOffset",81),angular.module("oneSearch.bento",[]).config(["$routeProvider",function(a){a.when("/bento/:s",{templateUrl:"bento/bento.tpl.html",controller:"BentoCtrl"})}]).service("Bento",["$routeParams","$rootScope","$q","oneSearch","mediaTypes",function(a,b,c,d,e){function f(a,b){var c=j.boxes[a].engines.indexOf(b);-1!=c&&(i(a),j.boxes[a].engines.splice(c,1))}function g(a){angular.forEach(j.boxes,function(b,c){f(c,a)})}function h(a){var b=j.boxes[a].engines.length,c=b>2?1:2>b?3:2;j.boxes[a].resultLimit=c}function i(a){c.when(j.boxes[a].results).then(function(b){var c=Object.keys(b).length,d=j.boxes[a].engines.length;j.boxes[a].resultLimit<3&&2>c&&2>d&&j.boxes[a].resultLimit++})}var j=this;this.boxes={},this.boxMenu=[],this.engines={};var k;this.getBoxes=function(){k=d.searchAll(a),angular.copy(e.types,j.boxes),angular.forEach(j.boxes,function(a,b){h(b),j.boxes[b].results={},j.boxes[b].resourceLinks={},j.boxes[b].resourceLinkParams={}}),angular.forEach(k,function(a,b){a.response.then(function(c){var h=a.getResults(c),i=a.getResourceLink(c);if(isEmpty(h))g(b);else{h=h.map(function(a,b){var c=a;return c.position=b,c});var k=e.groupBy(h,a.mediaTypes);Object.keys(j.boxes).forEach(function(c){k.hasOwnProperty(c)&&(j.boxes[c].results[b]=k[c].sort(function(a,b){return a.position>b.position?1:a.position<b.position?-1:0}),j.boxes[c].resourceLinks[b]=decodeURIComponent(i[a.id]),angular.isObject(a.mediaTypes)&&(j.boxes[c].resourceLinkParams[b]=a.mediaTypes.types[c])),f(c,b)}),j.engines[b]={},j.engines[b].tpl=d.getEngineTemplate(a),j.engines[b].controller=d.getEngineController(a)}},function(){g(b)})})}}]).controller("BentoCtrl",["$scope","Bento",function(a,b){a.$on("$routeChangeSuccess",function(){b.boxMenu=[],b.getBoxes()})}]).directive("bentoBox",["$rootScope","$controller","$compile","$animate","Bento",function(a,b,c,d,e){return{restrict:"A",scope:{},link:function(f,g,h){function i(a){isEmpty(e.boxes[a].results)&&(h.hideIfEmpty?g.addClass("hidden"):(g.append("<strong>No Results</strong>"),g.addClass("text-muted"))),e.boxMenu=e.boxMenu.map(function(b){return b.box===a&&(b.loaded=!0,isEmpty(e.boxes[a].results)&&(b.noResults=!0)),b}),d.leave(k),m()}var j=h.bentoBox;g.addClass(j),g.parent().attr("id",j+"-parent"),f.bento=e;var k=angular.element('<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>'),l=g.find("h2");l.attr("id",j),h.omitFromMenu||e.boxMenu.push({box:j,title:l.text(),loaded:!1,noResults:!1}),d.enter(k,l,angular.element(l[0].lastChild));var m=f.$watchCollection(function(){return e.boxes[j].engines},function(d,f){if(d!==f){for(var h="",k=0,m=f.length;m>k;k++){var n=f[k];if(!(d.indexOf(n)>-1)){h=n;break}}var o=a.$new();o.items=e.boxes[j].results[h],o.items&&o.items.length>0?(o.isCollapsed=!0,o.engine=h,o.resourceLink="undefined"===e.boxes[j].resourceLinks[h]?!1:e.boxes[j].resourceLinks[h],o.resourceLinkParams=e.boxes[j].resourceLinkParams[h],o.boxName=l.text(),o.mediaType=j,e.engines[h].tpl.then(function(a){var d=["$scope","Bento",function(a,c){c.engines[a.engine].controller&&angular.extend(this,b(c.engines[a.engine].controller,{$scope:a})),a.box=c.boxes[j]}],e=b(d,{$scope:o});g.data("$ngControllerController",e),g.children().data("$ngControllerController",e);var f=angular.element('<div class="animate-repeat bento-box-item" ng-repeat="item in items | limitTo: box.resultLimit">'+a+'</div><div class="resource-link-container"><a class="btn btn-link btn-sm" ng-href="{{resourceLink}}" ng-if="resourceLink">More results from {{engine | ucfirst}}  <span class="fa fa-fw fa-external-link"></span></a></div>'),h=c(f)(o);g.append(h)})):a.$broadcast("NoResultsForEngine",{engine:h,box:j}),0==d.length&&i(j)}},!0)}}}]).directive("bentoBoxMenu",["Bento","$document","$rootScope","$timeout","$q",function(a,b,c,d){return{restrict:"AC",link:function(c){var e,f;c.boxMenu=a.boxMenu,c.selectBox=function(a){f&&(d.cancel(f),b.off("scroll",i)),h(),g(a),f=d(function(){b.on("scroll",i)},500)};var g=function(a){e=angular.element(document.getElementById(a+"-parent")),e.addClass("box-selected")},h=function(){e&&e.removeClass("box-selected")},i=function(){h(),b.off("scroll",i)}}}}]),angular.module("oneSearch.common",["common.mediaTypes","common.oneSearch","common.engines","filters.nameFilter"]),angular.module("oneSearch.common").factory("dataFactory",["$http",function(a){return{get:function(b){return a.get(b).then(function(a){return a.data})}}}]).directive("suggestOneSearch",["$timeout",function(a){return{restrict:"AEC",scope:{prompt:"@",model:"=",search:"="},controller:["$scope","$window","$timeout","dataFactory",function(a,b,c,d){a.items={},a.filteredItems=[],a.model="",a.current=-1,a.originalValue=a.model,a.dataRequested=!1,a.numShow=5,a.selected=!1,a.onChange=function(){if(a.selected=!0,(a.model.length<3||a.model.indexOf(a.originalValue)<0&&a.model.length>=a.originalValue.length||a.originalValue.indexOf(a.model)<0&&a.model.length<=a.originalValue.length)&&(a.items={},a.setCurrent(-1,!1),a.dataRequested=!1,a.selected=!1),a.model.length>2&&!a.dataRequested){var b=a.model.replace(/\//g," ");d.get("//wwwdev2.lib.ua.edu/oneSearch/api/suggest/"+encodeURI(b)).then(function(b){a.items.suggest=b,a.setCurrent(-1,!1)}),a.dataRequested=!0}a.model.length>2&&c(function(){var b=a.model.replace(/\//g," ");d.get("//wwwdev2.lib.ua.edu/oneSearch/api/recommend/"+encodeURI(b)).then(function(b){a.items.recommend=b}),d.get("//wwwdev2.lib.ua.edu/staffDir/api/subject/"+encodeURI(b)+"/match/startwith").then(function(b){a.items.subjects=b}),d.get("https://www.googleapis.com/customsearch/v1?key=AIzaSyCMGfdDaSfjqv5zYoS0mTJnOT3e9MURWkU&cx=003453353330912650815:lfyr_-azrxe&q="+encodeURI(b)+"&siteSearch=ask.lib.ua.edu").then(function(b){a.items.faq=b.items})},0),a.originalValue=a.model},a.go=function(c){a.model="",a.originalValue=a.model,b.location.href=c},a.setCurrent=function(b,c){if(a.current=b,"undefined"!=typeof a.items.suggest)for(var d=0;d<a.items.suggest.length;d++)a.items.suggest[d]["class"]="";b>=0&&a.filteredItems.length>0&&(b>a.filteredItems.length-1&&(b=a.filteredItems.length-1),c&&(a.model=a.filteredItems[b].search),a.filteredItems[b]["class"]="active",a.current=b)},a.onFocus=function(){angular.isDefined(a.model)&&a.model.length>2&&(a.selected=!0)},a.onBlur=function(){a.selected=!1},a.compare=function(a){return function(b){return 0!=b.search.indexOf(a)||angular.equals(b.search.toLowerCase(),a.toLowerCase())?!1:!0}}}],link:function(b,c){b.showSuggestions=!1;var d=b.$watch("items",function(a){var c=!1;for(var d in a)if(d.length>0){c=!0;break}b.showSuggestions=b.model.length>2&&c},!0);c.bind("keydown",function(a){switch(a.keyCode){case 38:b.current>0?(b.setCurrent(b.current-1,!0),a.preventDefault()):(b.setCurrent(-1,!1),b.model=b.originalValue,a.preventDefault());break;case 40:b.model.length>2&&b.current<b.numShow-1&&b.current<b.items.suggest.length-1&&(b.setCurrent(b.current+1,!0),a.preventDefault());break;case 13:b.selected=!1;break;case 8:case 46:b.selected=!0}b.$apply()}),b.$on("$destroy",function(){c.unbind("keydown"),d()}),b.handleSelection=function(c){a(function(){b.model=c,b.originalValue="",b.items={},b.setCurrent(-1,!1),b.dataRequested=!1,b.selected=!1,b.$apply(),b.search()},0)}},templateUrl:"common/directives/suggest/suggest.tpl.html"}}]),angular.module("engines.acumen",[]).config(["oneSearchProvider",function(a){a.engine("acumen",{id:8,priority:3,resultsPath:"Acumen.data",totalsPath:"Acumen.metadata.numFound",templateUrl:"common/engines/acumen/acumen.tpl.html",controller:"AcumenCtrl"})}]).controller("AcumenCtrl",["$scope","$filter",function(a){for(var b=a.items,c=0,d=b.length;d>c;c++)b[c].type&&(b[c].type="text"==b[c].type[0]&&b[c].details&&b[c].details.genre?b[c].details.genre.sort().shift():b[c].type.sort().shift())}]),angular.module("engines.catalog",[]).config(["oneSearchProvider",function(a){a.engine("catalog",{id:64,priority:5,resultsPath:"Catalog.list",totalsPath:"Catalog.total",mediaTypes:{path:"bibFormat",types:{books:["aa","ac","ad","am"],journals:["ab","as","bb","bs","cb","cs","db","ds","eb","es","fb","fs","gb","gs","ib","is","jb","js","kb","ks","mb","ms","ob","os","pb","ps","rb","rs","tb","ts"],media:["ga","gc","gd","gm","ia","ic","id","im","ja","jc","jd","jm"]}},templateUrl:"common/engines/catalog/catalog.tpl.html",controller:"CatalogCtrl"})}]).filter("catalogSplitTitleAuthor",[function(){return function(a){if(a.indexOf("/")>-1){var b=a.split(/\s\/\sedited\sby\s([^.+]+)\./);a=b}return a}}]).controller("CatalogCtrl",["$scope","$filter",function(a,b){for(var c={bc:"Archive/Manuscript",cm:"Music Score",em:"Map",im:"Nonmusical Recording",jm:"Musical Recording",mm:"Computer File/Software",om:"Kit",pc:"Mixed Material/Collection",pm:"Mixed Material",rm:"Visual Material"},d=a.items,e=0;e<d.length;e++){var f=d[e].bibFormat;if(d[e].mediaType=c[f],!d[e].author){var g=b("catalogSplitTitleAuthor")(d[e].title);angular.isArray(g)&&(d[e].title=g[0],d[e].author=g[2])}}if(angular.isArray(a.resourceLinkParams)){var h="&type=",i=h+a.resourceLinkParams.join(h);a.resourceLink+=i}a.items=d}]),angular.module("engines.databases",[]).config(["oneSearchProvider",function(a){a.engine("databases",{id:2,priority:1,resultsPath:"Databases.databases",totalsPath:"Databases.totalResults",templateUrl:"common/engines/databases/databases.tpl.html"})}]),angular.module("engines.ejournals",[]).config(["oneSearchProvider",function(a){a.engine("ejournals",{id:4,priority:6,resultsPath:"eJournals.results",totalsPath:"eJournals.total",mediaTypes:{path:"type",types:{books:"book",journals:"periodical"}},templateUrl:"common/engines/ejournals/ejournals.tpl.html",controller:"EjouralsCtrl"})}]).controller("EjouralsCtrl",["$scope",function(a){var b;switch(a.mediaType){case"books":b="SS_searchTypeBook=yes";break;case"journals":b="SS_searchTypeJournal=yes";break;case"other":b="SS_searchTypeOther=yes"}b&&(a.resourceLink=a.resourceLink.replace("SS_searchTypeAll=yes&SS_searchTypeBook=yes&SS_searchTypeJournal=yes&SS_searchTypeOther=yes",b))}]),angular.module("common.engines",["engines.acumen","engines.catalog","engines.databases","engines.scout","engines.googleCS","engines.faq","engines.libguides","engines.ejournals","engines.recommend"]).service("enginesTemplateFactory",["$http","$templateCache",function(a,b){this.get=function(a){return angular.isDefined(a.templateUrl)?this.fromUrl(a.templateUrl):null},this.fromUrl=function(c){return null==c?null:a.get(c,{cache:b,headers:{Accept:"text/html"}}).then(function(a){return a.data})}}]),angular.module("engines.faq",[]).config(["oneSearchProvider",function(a){a.engine("faq",{id:16,priority:2,resultsPath:"GoogleCS.items",totalsPath:"GoogleCS.searchInformation.totalResults",filterQuery:"site:ask.lib.ua.edu",templateUrl:"common/engines/google-cs/google-cs.tpl.html"})}]),angular.module("engines.googleCS",[]).config(["oneSearchProvider",function(a){a.engine("googleCS",{id:16,priority:2,resultsPath:"GoogleCS.items",totalsPath:"GoogleCS.searchInformation.totalResults",filterQuery:"-site:guides.lib.ua.edu -site:ask.lib.ua.edu",templateUrl:"common/engines/google-cs/google-cs.tpl.html"})}]),angular.module("engines.libguides",[]).config(["oneSearchProvider",function(a){a.engine("libguides",{id:16,priority:2,resultsPath:"GoogleCS.items",totalsPath:"GoogleCS.searchInformation.totalResults",filterQuery:"site:guides.lib.ua.edu",templateUrl:"common/engines/google-cs/google-cs.tpl.html"})}]),angular.module("engines.recommend",[]).config(["oneSearchProvider",function(a){a.engine("recommend",{id:512,priority:0,resultsPath:"Recommendations",templateUrl:"common/engines/recommend/recommend.tpl.html"})}]),angular.module("engines.scout",[]).config(["oneSearchProvider",function(a){a.engine("scout",{id:1,priority:4,resultsPath:"Scout.SearchResult.Data.Records",totalsPath:"Scout.SearchResult.Statistics.TotalHits",mediaTypes:{path:"Header.PubTypeId",types:{books:["book","ebook"],articles:"academicJournal",media:["audio","videoRecording"]}},templateUrl:"common/engines/scout/scout.tpl.html",controller:"ScoutCtrl"})}]).controller("ScoutCtrl",["$scope",function(a){for(var b=a.items,c=0;c<b.length;c++){"audio"==b[c].Header.PubTypeId&&(b[c].mediaType="Audio"),"videoRecording"==b[c].Header.PubTypeId&&(b[c].mediaType="Video Recording");var d=[];if(angular.isDefined(b[c].RecordInfo.BibRecord.BibRelationships.IsPartOfRelationships)){d=b[c].RecordInfo.BibRecord.BibRelationships.IsPartOfRelationships;for(var e=0,f=d.length;f>e;e++)if(angular.isDefined(d[e].BibEntity.Identifiers)&&"issn-print"===d[e].BibEntity.Identifiers[0].Type&&(d[e].BibEntity.Titles&&(b[c].source=d[e].BibEntity.Titles[0].TitleFull),angular.isDefined(d[e].BibEntity.Numbering)))for(var g=0,h=d[e].BibEntity.Numbering.length;h>g;g++)b[c].source+=" "+d[e].BibEntity.Numbering[g].Type.substring(0,3)+"."+d[e].BibEntity.Numbering[g].Value}if(angular.isDefined(b[c].Items))for(var e=0;e<b[c].Items.length;e++)"Src"==b[c].Items[e].Group&&(b[c].source=b[c].Items[e].Data)}a.items=b;var i=angular.copy(a.boxName),j=angular.copy(a.resourceLink);i=i.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(a,b){return 0===+a?"":0==b?a.toLowerCase():a.toUpperCase()}),j.indexOf("facet=")>0?j=j.replace(/&facet=(.+)&?/,i):j+="&facet="+i,a.resourceLink=angular.copy(j)}]),angular.module("filters.nameFilter",[]).filter("nameFilter",["$filter",function(){return function(a){if(a.indexOf(",")>-1){var b=a.split(",");a=b.map(function(a){return a.trim()}).reverse().join(" ")}return a}}]);var invertArrayToObject=function(a){var b={};return Object.keys(a).map(function(c){for(var d=0,e=a[c].length;e>d;d++)b[a[c][d]]=c}),b},hasOwnProperty=Object.prototype.hasOwnProperty;angular.module("common.mediaTypes",[]).provider("mediaTypes",[function(){function a(a){var b={};return angular.forEach(a,function(a,c){var d={};switch(typeof a){case"string":case"number":a=[a];break;case"object":a=toArray(a)}d[c]=a,d=invertArrayToObject(d),angular.extend(b,d)}),b}var b={other:{engines:[],loaded:!1}};this.type=function(a,c){b[a]||(b[a]={engines:[],loaded:!1}),b.other.engines.indexOf(c)>-1||b.other.engines.push(c),b[a].engines.push(c)},this.$get=["$parse",function(c){return{types:b,groupBy:function(b,d){var e={};if(angular.isObject(d)){var f,g,h=a(d.types),i=c(d.path);angular.forEach(b,function(a){f=i(a),g=h[f],angular.isUndefined(g)?(e.other||(e.other=[]),e.other.push(a)):(e[g]||(e[g]=[]),e[g].push(a))})}else e[d]=b;return e}}}]}]),angular.module("common.oneSearch",[]).factory("Search",["$http","$q",function(a,b){function c(c){var d=b.defer(),e="//wwwdev2.lib.ua.edu/oneSearch/api/search/"+c.s+"/engine/"+c.engine+"/limit/"+c.limit,f=a({method:"GET",url:e,timeout:d.promise}),g=f.then(function(a){return this.done=!0,a.data},function(){return b.reject("Error")});return g.done=!1,g.abort=function(){this.done=!0,d.resolve()},g["finally"](function(){g.abort=angular.noop,d=f=g=null,this.done=!1}),g}return{request:c}}]).provider("oneSearch",["mediaTypesProvider",function(a){var b={};this.engine=function(c,d){if(angular.isString(c)){var e={id:null,priority:10,resultsPath:null,totalsPath:null,mediaTypes:null,templateUrl:null,filterQuery:null,controller:null},f=angular.extend(e,d);f.id&&(f.mediaTypes?Object.keys(f.mediaTypes.types).map(function(b){a.type(b,c)}):(a.type(c,c),f.mediaTypes=c),f.name=c,b[c]=f)}else console.log({Error:"oneSearch engine must have STRING defined name",engineParams:d})},this.$get=["$q","$parse","$filter","$rootScope","enginesTemplateFactory","SearchParams","Search",function(a,c,d,e,f,g,h){return{engines:b,searchAll:function(a){angular.extend(a,g);var e=d("orderObjectBy")(b,"priority");return angular.forEach(e,function(d,e){var f={engine:d.id};angular.extend(f,a),null!==d.filterQuery&&(f.s+=" "+d.filterQuery),d.response=h.request(f),angular.isDefined(d.resultsPath)&&(d.getResults=c(d.resultsPath)),angular.isDefined(d.totalsPath)&&(d.getTotal=c(d.totalsPath)),d.getResourceLink=c("resourceLinks"),b[e]=d}),b},getEngineTemplate:function(a){return f.get(a)},getEngineController:function(a){return angular.isDefined(a.controller)?a.controller:null}}}]}]).controller("OneSearchCtrl",["$scope","$location","$rootScope","$window","oneSearch",function(a,b,c,d,e){function f(){for(var a in e.engines)e.engines[a].response&&!e.engines[a].response.done&&e.engines[a].response.abort()}a.searchText,a.search=function(){if(a.searchText){a.searchText=a.searchText.replace(/[\/]/," ");var c=encodeURIComponent(a.searchText);if(f(),!b.path()||b.path().indexOf("/bento")<0){var e="//"+b.host()+"#/bento/"+c;d.location=e}else b.path("/bento/"+a.searchText)}},a.getRecommend=function(a){return $resource("//wwwdev2.lib.ua.edu/oneSearch/api/recommend/:search").query({search:a}).$promise.then(function(a){return a})},c.$on("$routeChangeSuccess",function(b,c){var d=c.params.s;a.searchText!==d&&(a.searchText=d)})}]).filter("orderObjectBy",function(){
return function(a,b,c){function d(a,b){return a[b]}var e=[],f={};angular.forEach(a,function(a){e.push(a)}),e.sort(function(a,c){var e,f=b.split(".").reduce(d,a),g=b.split(".").reduce(d,c);return e=f===g?0:f>g?1:-1}),c&&e.reverse();for(var g=0,h=e.length;h>g;g++){var i=e[g].name;f[i]=e[g]}return f}});